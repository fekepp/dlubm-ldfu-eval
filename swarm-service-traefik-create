#!/bin/bash


echo "Swarm > Networks > Traefik > Create network"
docker-machine ssh dlubm-swarm-manager "docker network create --driver=overlay traefik_proxy"
echo "Swarm > Networks > Traefik > Created network"


echo "Swarm > Services > Traefik > Create service"
docker-machine ssh dlubm-swarm-manager \
	"docker service create \
		--name traefik \
		--constraint=node.role==manager \
		--publish 80:80 \
		--publish 8080:8080 \
		--mount type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock \
		--network traefik_proxy \
		traefik \
			--docker \
			--docker.swarmmode \
			--docker.domain=dlubm.ddns.me \
			--docker.watch \
			--web"
echo "Swarm > Services > Traefik > Created service"
